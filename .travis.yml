language: node_js
node_js: "10.15"
cache: yarn

env:
  - DOCKER_COMPOSE_VERSION=1.23.2
before_install:
  - sudo rm /usr/local/bin/docker-compose
  - curl -L https://github.com/docker/compose/releases/download/${DOCKER_COMPOSE_VERSION}/docker-compose-`uname -s`-`uname -m` > docker-compose
  - chmod +x docker-compose
  - sudo mv docker-compose /usr/local/bin

after_script: ./scripts/doc.sh master; ./scripts/doc.sh v0.4.14

deploy:
  -
    provider: script
    script: bash scripts/doc.sh master
    on:
      branch: master
  -
    provider: script
    script: bash scripts/doc.sh $TRAVIS_TAG
    on:
      tags: true
  -
    provider: script
    script: bash scripts/deploy-image.sh latest
    on:
      branch: master
  -
    provider: script
    script: bash scripts/deploy-image.sh $TRAVIS_TAG
    on:
      tags: true
  -
    provider: script
    script: bash scripts/deploy-rancher.sh
    on:
      tags: true
      condition: "$TRAVIS_TAG =~ ^v[0-9]+\\.[0-9]+\\.[0-9]+$"
